<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ‡ç­¾é¡µè¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: 'Consolas', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }
        .section {
            background: #2a2a2a;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        button:hover {
            background: #00cc00;
        }
        #log {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
        .tab-btn {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #333;
            border: 2px solid #666;
            color: white;
        }
        .tab-btn.active {
            background: #00ff00;
            color: #000;
            border-color: #00ff00;
        }
        .tab-content {
            display: none;
            background: #2a2a2a;
            padding: 20px;
            border: 2px solid #00ff00;
            border-radius: 4px;
            min-height: 200px;
        }
        .tab-content.active {
            display: block !important;
        }
    </style>
</head>
<body>
    <h1>ğŸ” æ ‡ç­¾é¡µç³»ç»Ÿè¯Šæ–­å·¥å…·</h1>
    
    <div class="section">
        <h2>1. ç¼“å­˜æ£€æµ‹</h2>
        <div id="cache-check"></div>
        <button onclick="checkCache()">æ£€æŸ¥ç¼“å­˜çŠ¶æ€</button>
        <button onclick="location.reload(true)">ç¡¬åˆ·æ–°é¡µé¢</button>
    </div>
    
    <div class="section">
        <h2>2. æµ‹è¯•æ ‡ç­¾é¡µ</h2>
        <div>
            <button class="tab-btn active" data-tab="tab1">æ ‡ç­¾ 1</button>
            <button class="tab-btn" data-tab="tab2">æ ‡ç­¾ 2</button>
            <button class="tab-btn" data-tab="tab3">æ ‡ç­¾ 3</button>
        </div>
        <div style="margin-top: 10px;">
            <div id="tab1" class="tab-content active">
                <h3 class="success">âœ… æ ‡ç­¾é¡µ 1 å†…å®¹</h3>
                <p>å¦‚æœä½ èƒ½çœ‹åˆ°è¿™ä¸ªï¼Œè¯´æ˜æ ‡ç­¾é¡µ 1 æ˜¾ç¤ºæ­£å¸¸ï¼</p>
            </div>
            <div id="tab2" class="tab-content">
                <h3 class="success">âœ… æ ‡ç­¾é¡µ 2 å†…å®¹</h3>
                <p>å¦‚æœä½ èƒ½çœ‹åˆ°è¿™ä¸ªï¼Œè¯´æ˜æ ‡ç­¾é¡µåˆ‡æ¢æˆåŠŸäº†ï¼</p>
            </div>
            <div id="tab3" class="tab-content">
                <h3 class="success">âœ… æ ‡ç­¾é¡µ 3 å†…å®¹</h3>
                <p>å®Œç¾ï¼æ ‡ç­¾é¡µç³»ç»Ÿå·¥ä½œæ­£å¸¸ï¼</p>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h2>3. DOM æ£€æµ‹</h2>
        <button onclick="checkDOM()">æ£€æµ‹é¡µé¢å…ƒç´ </button>
        <div id="dom-check"></div>
    </div>
    
    <div class="section">
        <h2>4. å®æ—¶æ—¥å¿—</h2>
        <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        <div id="log"></div>
    </div>
    
    <div class="section">
        <h2>5. ä¸»åº”ç”¨æµ‹è¯•</h2>
        <button onclick="testMainApp()">æµ‹è¯•ä¸»åº”ç”¨</button>
        <button onclick="window.open('/', '_blank')">æ‰“å¼€ä¸»åº”ç”¨</button>
        <div id="main-app-test"></div>
    </div>

    <script>
        // æ—¥å¿—ç³»ç»Ÿ
        const logDiv = document.getElementById('log');
        function log(message, type = 'info') {
            const colors = {
                info: '#00ff00',
                error: '#ff0000',
                warning: '#ffaa00'
            };
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.style.color = colors[type] || '#00ff00';
            line.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(line);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            logDiv.innerHTML = '';
            log('æ—¥å¿—å·²æ¸…é™¤');
        }
        
        // æ ‡ç­¾é¡µåˆ‡æ¢é€»è¾‘
        log('åˆå§‹åŒ–æ ‡ç­¾é¡µç³»ç»Ÿ...');
        const tabButtons = document.querySelectorAll('.tab-btn');
        log(`æ‰¾åˆ° ${tabButtons.length} ä¸ªæ ‡ç­¾æŒ‰é’®`);
        
        tabButtons.forEach((btn, index) => {
            log(`æ³¨å†ŒæŒ‰é’® ${index + 1}: ${btn.dataset.tab}`);
            btn.addEventListener('click', function() {
                const targetTab = this.dataset.tab;
                log(`ğŸ–±ï¸ ç‚¹å‡»æ ‡ç­¾: ${targetTab}`, 'warning');
                
                // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
                tabButtons.forEach(b => {
                    b.classList.remove('active');
                    log(`  ç§»é™¤ ${b.dataset.tab} çš„ active ç±»`);
                });
                this.classList.add('active');
                log(`  æ·»åŠ  ${targetTab} çš„ active ç±»`, 'info');
                
                // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                    log(`  éšè— ${content.id}`);
                });
                
                // æ˜¾ç¤ºç›®æ ‡æ ‡ç­¾é¡µ
                const target = document.getElementById(targetTab);
                if (target) {
                    target.classList.add('active');
                    const display = window.getComputedStyle(target).display;
                    log(`âœ… æ˜¾ç¤º ${targetTab}, display: ${display}`, 'info');
                } else {
                    log(`âŒ æ‰¾ä¸åˆ°å…ƒç´ : ${targetTab}`, 'error');
                }
            });
        });
        
        log('âœ… æ ‡ç­¾é¡µç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        
        // ç¼“å­˜æ£€æµ‹
        function checkCache() {
            const div = document.getElementById('cache-check');
            const now = new Date().getTime();
            const randomParam = Math.random();
            
            div.innerHTML = `
                <div class="success">å½“å‰æ—¶é—´æˆ³: ${now}</div>
                <div class="warning">éšæœºæ•°: ${randomParam}</div>
                <div>å¦‚æœæ¯æ¬¡ç‚¹å‡»æ˜¾ç¤ºä¸åŒçš„éšæœºæ•°ï¼Œè¯´æ˜æ²¡æœ‰ç¼“å­˜é—®é¢˜</div>
                <div style="margin-top: 10px;">
                    <strong>å»ºè®®æ“ä½œ:</strong><br>
                    1. æŒ‰ Ctrl+Shift+Delete æ¸…é™¤æµè§ˆå™¨ç¼“å­˜<br>
                    2. æˆ–è€…æŒ‰ Ctrl+Shift+R å¼ºåˆ¶åˆ·æ–°<br>
                    3. æˆ–è€…å…³é—­æ‰€æœ‰æµè§ˆå™¨çª—å£åé‡æ–°æ‰“å¼€
                </div>
            `;
            log(`ç¼“å­˜æ£€æµ‹: ${randomParam}`);
        }
        
        // DOM æ£€æµ‹
        function checkDOM() {
            const div = document.getElementById('dom-check');
            let html = '<div style="margin-top: 10px;">';
            
            // æ£€æŸ¥ä¸»åº”ç”¨çš„å…ƒç´ 
            const checks = [
                { selector: '.tab-btn', desc: 'æ ‡ç­¾æŒ‰é’®' },
                { selector: '.tab-content', desc: 'æ ‡ç­¾å†…å®¹' },
                { selector: '[data-tab="models"]', desc: 'æ¨¡å‹é…ç½®æŒ‰é’®' },
                { selector: '[data-tab="prompts"]', desc: 'æç¤ºè¯ç®¡ç†æŒ‰é’®' },
                { selector: '#models-tab', desc: 'æ¨¡å‹æ ‡ç­¾é¡µ' },
                { selector: '#prompts-tab', desc: 'æç¤ºè¯æ ‡ç­¾é¡µ' }
            ];
            
            checks.forEach(check => {
                const elements = document.querySelectorAll(check.selector);
                const found = elements.length > 0;
                const status = found ? 'âœ…' : 'âŒ';
                const color = found ? 'success' : 'error';
                html += `<div class="${color}">${status} ${check.desc}: ${elements.length} ä¸ª</div>`;
                log(`${status} ${check.desc}: ${elements.length}`);
            });
            
            html += '</div>';
            div.innerHTML = html;
        }
        
        // æµ‹è¯•ä¸»åº”ç”¨
        async function testMainApp() {
            const div = document.getElementById('main-app-test');
            log('å¼€å§‹æµ‹è¯•ä¸»åº”ç”¨...', 'warning');
            
            try {
                const response = await fetch('/static/script.js');
                const text = await response.text();
                
                // æ£€æŸ¥ç‰ˆæœ¬å·
                const versionMatch = text.match(/Version:\s*([\d.]+)/);
                const version = versionMatch ? versionMatch[1] : 'æœªæ‰¾åˆ°';
                
                // æ£€æŸ¥æ˜¯å¦åŒ…å«æ ‡ç­¾é¡µä»£ç 
                const hasTabCode = text.includes('æ ‡ç­¾é¡µåˆ‡æ¢');
                const hasPromptCode = text.includes('æç¤ºè¯ç®¡ç†åŠŸèƒ½');
                
                let html = '<div style="margin-top: 10px;">';
                html += `<div class="${version >= '17.0.0' ? 'success' : 'error'}">è„šæœ¬ç‰ˆæœ¬: ${version}</div>`;
                html += `<div class="${hasTabCode ? 'success' : 'error'}">${hasTabCode ? 'âœ…' : 'âŒ'} åŒ…å«æ ‡ç­¾é¡µåˆ‡æ¢ä»£ç </div>`;
                html += `<div class="${hasPromptCode ? 'success' : 'error'}">${hasPromptCode ? 'âœ…' : 'âŒ'} åŒ…å«æç¤ºè¯ç®¡ç†ä»£ç </div>`;
                html += `<div class="warning">è„šæœ¬å¤§å°: ${(text.length / 1024).toFixed(2)} KB</div>`;
                
                if (version < '17.0.0' || !hasTabCode) {
                    html += '<div class="error" style="margin-top: 10px;">âš ï¸ æ£€æµ‹åˆ°æ—§ç‰ˆæœ¬ï¼è¯·:</div>';
                    html += '<div class="error">1. å®Œå…¨å…³é—­æµè§ˆå™¨</div>';
                    html += '<div class="error">2. åˆ é™¤æµè§ˆå™¨ç¼“å­˜</div>';
                    html += '<div class="error">3. é‡æ–°æ‰“å¼€æµè§ˆå™¨å¹¶è®¿é—®</div>';
                }
                
                html += '</div>';
                div.innerHTML = html;
                
                log(`ä¸»åº”ç”¨ç‰ˆæœ¬: ${version}`);
                log(`æ ‡ç­¾é¡µä»£ç : ${hasTabCode ? 'å­˜åœ¨' : 'ç¼ºå¤±'}`);
                log(`æç¤ºè¯ä»£ç : ${hasPromptCode ? 'å­˜åœ¨' : 'ç¼ºå¤±'}`);
                
            } catch (error) {
                div.innerHTML = `<div class="error">æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                log(`æµ‹è¯•ä¸»åº”ç”¨å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹
        window.addEventListener('load', () => {
            log('===== é¡µé¢åŠ è½½å®Œæˆ =====', 'warning');
            setTimeout(() => {
                checkDOM();
                checkCache();
            }, 500);
        });
    </script>
</body>
</html>
